@model zuHause.Models.FurnitureProduct

@{
    ViewBag.Title = "商品詳細頁";
    Layout = "~/Views/Shared/_NavigationBar.cshtml";

    var properties = ViewBag.PropertyList as List<zuHause.Models.Property>;
    var currentProperty = ViewBag.CurrentProperty as zuHause.Models.Property;
    var contractEndDate = ViewBag.ContractEndDate as string;
    var rentalDays = (int)(ViewBag.RentalDays ?? 0);
    var categories = ViewBag.categories as List<zuHause.Models.FurnitureCategory>;
}

<div class="container-fluid mt-4">
    <div class="row">
        <!-- 左側分類清單 -->
    <div class="col-md-2">
        <h5>商品分類</h5>
        @Html.Partial("_FurnitureCategoryList", categories)

        <hr />
        <h6>租借須知</h6>
        <ul>
            <li>租期須滿三個月</li>
            <li>提前解約須補差額</li>
            <li>請妥善保管家具</li>
        </ul>
    </div>

        <!-- 右側商品資訊 -->
        <div class="col-md-10">
            <div class="row">
                <!-- 商品圖片 -->
                <div class="col-md-5">
                    <img src="@Model.ImageUrl" class="img-fluid" alt="@Model.ProductName" />
                </div>

                <!-- 商品資訊 -->
                <div class="col-md-7">
                    <h3 class="mb-3">@Model.ProductName</h3>
                    <p><strong>售價：</strong>NT$@Model.ListPrice</p>
                    <p><strong>每日租金：</strong><span class="text-danger">NT$@Model.DailyRental</span></p>
                    <p><strong>租期總天數：</strong>@rentalDays 天</p>
                    <p><strong>總租金：</strong class="text-danger">NT$@(Model.DailyRental * rentalDays)</p>
                    <p>@Model.Description</p>

                    <!-- 綁定中的房源卡片 -->
                    @if (currentProperty != null)
                    {
                        <div class="bg-light p-3 mb-3 rounded border">
                            <h5 class="text-danger mb-2">目前綁定房源</h5>
                            <p><strong>房源 ID：</strong>@currentProperty.PropertyId</p>
                            <p><strong>標題：</strong>@currentProperty.Title</p>
                            <p><strong>到期日：</strong>@contractEndDate</p>
                        </div>
                    }

                    <!-- 房源下拉選單 -->
                    <form method="post" action="/Furniture/AddToCart">
                        <div class="mb-3">
                            <label for="PropertyId" class="form-label">選擇房源</label>
                            <select name="PropertyId" class="form-select" required>
                                <option value="">請選擇房源</option>
                                @foreach (var p in ViewBag.PropertyList)
                                    {
                                        string endDate = p.ContractEndDate != null ? ((DateOnly)p.ContractEndDate).ToString("yyyy-MM-dd") : "無";

                                        <option value="@p.PropertyId">
                                            標題：@p.Title - 截止：@endDate
                                        </option>
                                    }
                            </select>
                        </div>
                        <input type="hidden" name="ProductId" value="@Model.FurnitureProductId" />
                        <button type="submit" class="btn btn-info w-100">加入租借清單</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
