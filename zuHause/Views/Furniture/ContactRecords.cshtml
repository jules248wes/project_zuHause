@model List<zuHause.Models.CustomerServiceTicket>
@{
    Layout = "~/Views/Shared/_NavigationBar.cshtml";
    ViewBag.Title = "聯繫紀錄";
}

<div class="container-fluid">
    <div class="row mt-3">
        <!-- 左側功能列 -->
        <div class="col-md-2">
            <h5>會員功能</h5>
            <ul class="list-group">
                <li class="list-group-item">
                    <a href="/Furniture/OrderHistory" class="text-decoration-none">租借 / 購買付款查詢</a>
                </li>
                <li class="list-group-item active">
                    <a href="/Furniture/ContactRecords" class="text-white text-decoration-none">聯繫紀錄</a>
                </li>
                <li class="list-group-item">
                    <a href="/Furniture/Cart" class="text-decoration-none">購物車</a>
                </li>
                <li class="list-group-item">
                    <a href="/Member/Logout" class="text-decoration-none">登出</a>
                </li>
            </ul>
        </div>

        <!-- 右側內容 -->
        <div class="col-md-10">
            <h4 class="mb-3">聯繫紀錄</h4>

            @if (Model == null || !Model.Any())
            {
                <div class="alert alert-info">目前無聯繫紀錄。</div>
            }
            else
            {
                foreach (var ticket in Model)
                {
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <strong>表單編號：</strong>REQ@(@ticket.TicketId.ToString("D12"))<br />
                            <strong>填寫時間：</strong>@ticket.CreatedAt.ToString("yyyy-MM-dd HH:mm")
                        </div>
                        <div class="card-body">
                            <p><strong>主旨：</strong>@ticket.Subject</p>
                            <p><strong>房源編號：</strong>@ticket.Property?.PropertyId</p>
                            <p><strong>聯絡人：</strong>@ticket.Member.MemberName　|　Email：@ticket.Member.Email　|　電話：@ticket.Member.PhoneNumber</p>
                            <p><strong>需求內容：</strong>@ticket.TicketContent</p>
                            <p class="mb-0">
                                <strong>回覆內容：</strong><br />
                                @if (!string.IsNullOrEmpty(ticket.ReplyContent))
                                {
                                    <span class="text-success">@Html.Raw(ticket.ReplyContent)</span>
                                }
                                else
                                {
                                    <span class="text-muted">尚未回覆</span>
                                }
                            </p>
                        </div>
                        <div class="card-footer text-end">
                            @if (ticket.IsResolved)
                            {
                                <span class="badge bg-success">已回覆</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">等待回覆</span>
                            }
                        </div>
                    </div>
                }
            }

        </div>
    </div>
</div>
