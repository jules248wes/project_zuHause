@model List<zuHause.ViewModels.FurnitureCardViewModel>
@{
    ViewBag.Title = "家具管理";
}
<div class="container-fluid">
    <div class="row">

        <!-- Main Content -->
        <div class="col-md-10 p-4">
            <!-- 搜尋 + 篩選 -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4>家具列表</h4>
                <div class="d-flex gap-2">
                    <select class="form-select">
                        <option selected>全部類別</option>
                        <option>沙發</option>
                        <option>書桌</option>
                        <option>衣櫃</option>
                    </select>
                    <input type="text" class="form-control" placeholder="搜尋關鍵字" />
                </div>
            </div>
            <!-- 家具卡片列表（加了 .furniture-list-scroll） -->
            <div class="furniture-list-scroll mb-4">
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    <!-- 你的 .col > .card 組件，一樣放這裡 -->
                    @foreach (var item in Model)
                    {
                        <div class="col">
                            <div class="card h-100" >
                                <div class="card-body">
                                    <p class="mb-1">家具編號: @item.FurnitureID</p>
                                    <p class="mb-1">名稱: @item.Name</p>
                                    <p class="mb-1">狀態: @item.Status</p>
                                    <p class="mb-1">庫存: @item.Stock</p>
                                    <p class="mb-1">以出租: @item.RentedCount</p>
                                    <p class="mb-1">類別: @item.Type</p>
                                    <p class="mb-1">介紹: @item.Description</p>
                                    <p class="mb-1">原價: NT$ @item.OriginalPrice</p>
                                    <p class="mb-1">每日租金: NT$ @item.RentPerDay</p>
                                    <p class="mb-1">上架時間: @item.ListDate.ToString("yyyy/M/d HH:mm") ~ @item.DelistDate.ToString("yyyy/M/d HH:mm")</p>
                                    <p class="mb-1">建立時間: @(item.CreatedAt?.ToString("yyyy/M/d HH:mm") ?? "未設定")</p>
                                    <p class="mb-1">更新時間: @(item.UpdatedAt?.ToString("yyyy/M/d HH:mm") ?? "未更新")</p>


                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-sm btn-primary" onclick="editFurniture('@item.FurnitureID')">編輯</button>

                                        @if (item.Status == "上架")
                                        {
                                            <button class="btn btn-sm btn-warning" onclick="event.stopPropagation(); setProductOffline('@item.FurnitureID')">提前下架</button>
                                        }
                                        else
                                        {
                                            <button class="btn btn-sm btn-secondary" disabled>已下架</button>
                                        }

                                        <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteFurniture('@item.FurnitureID')">刪除</button>
                                    </div>

                                </div>
                            </div>
                        </div>
                    }

                </div>
            </div>


            <!-- 分隔線 -->
            <hr class="my-4" />

            <!-- 家具上傳 / 編輯表單 -->
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 id="formMode">🆕 家具上傳模式</h5>
                <button class="btn btn-sm btn-outline-secondary" onclick="resetForm()">返回上傳模式</button>
            </div>

            <div class="card p-4" id="furnitureForm">
                <!-- 家具名稱 -->
                <div class="mb-3">
                    <label class="form-label">家具名稱</label>
                    <input type="text" class="form-control" id="furnitureName" />
                </div>

                <!-- 家具介紹 -->
                <div class="mb-3">
                    <label class="form-label">家具介紹</label>
                    <textarea class="form-control" id="furnitureDesc"></textarea>
                </div>

                <!-- 價格 -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">原價</label>
                        <input type="number" class="form-control" id="originalPrice" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">每日租金</label>
                        <input type="number" class="form-control" id="rentPerDay" />
                    </div>
                </div>

                <!-- 類別、庫存、時間 -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">上架庫存</label>
                        <input type="number" class="form-control" id="furnitureStock" />
                    </div>
                    <div class="col-md-4">
                       <label class="form-label">家具類別</label>
                           <select class="form-select" id="furnitureType">
                            <option value="">請選擇</option>
                            @foreach (var c in ViewBag.Categories as List<zuHause.Models.FurnitureCategory>)
                            {
                                <option value="@c.FurnitureCategoriesId">@c.Name</option>
                            }
                            </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">上架時間</label>
                        <input type="datetime-local" class="form-control" id="listDate" />
                        <label class="form-label">下架時間</label>
                        <input type="datetime-local" class="form-control" id="delistDate" />
                    </div>
                </div>

                <!-- 狀態 -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">商品狀態</label>
                        <select class="form-select" id="productStatus">
                            <option value="true">上架</option>
                            <option value="false">下架</option>
                        </select>
                    </div>
                </div>

                <!-- 操作按鈕 -->
                <div class="mt-4 d-flex justify-content-between">
                    <button id="submitBtn" class="btn btn-success">確認上傳</button>
                    <button class="btn btn-danger" onclick="resetForm()">取消上傳</button>
                </div>
            </div>
            
            <!-- 庫存異動紀錄區塊（直接展開） -->
            <div class="card p-3 mt-4">
                <h5 class="mb-3">📋 所有家具庫存異動紀錄</h5>
                <table class="table table-sm table-bordered text-center">
                    <thead>
                        <tr>
                            <th>商品ID</th>
                            <th>事件類型</th>
                            <th>異動數量</th>
                            <th>來源類型</th>
                            <th>來源編號</th>
                            <th>發生時間</th>
                            <th>寫入時間</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryEventBody">
                        <!-- JavaScript 動態填入 -->
                    </tbody>
                </table>
            </div>
            <!-- 🔧 庫存調整區 -->
            <hr class="my-4" />
            <div class="card p-4">
                <h5>🔧 手動調整庫存</h5>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">📦 商品編號（Furniture ID）</label>
                        <input type="text" class="form-control" id="adjustProductId" placeholder="如 F123" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">🔢 異動數量（可為負）</label>
                        <input type="number" class="form-control" id="adjustQuantity" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">📋 來源類型</label>
                        <input type="text" class="form-control" id="adjustSourceType" placeholder="手動調整 / 補貨 / 減損" />
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">🆔 來源編號（選填）</label>
                        <input type="text" class="form-control" id="adjustSourceId" placeholder="如訂單編號或維修單" />
                    </div>
                </div>

                <button class="btn btn-primary" onclick="submitInventoryAdjustment()">✅ 送出異動</button>
            </div>

        </div>

    </div>
</div>