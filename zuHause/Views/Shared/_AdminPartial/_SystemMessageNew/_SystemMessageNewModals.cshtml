@{
    // 模擬訊息模板資料
    var messageTemplates = new[] {
        new {
            Category = "maintenance",
            CategoryText = "維護通知",
            Title = "模板：系統維護通知",
            Preview = "親愛的會員您好，為提供更優質的服務...",
            Content = "親愛的會員您好，為提供更優質的服務，本平台將於 [日期] [時間] 進行系統維護與升級作業，屆時將暫停所有服務。造成您的不便，敬請見諒。"
        },
        new {
            Category = "promotion",
            CategoryText = "優惠活動",
            Title = "模板：通用優惠活動",
            Preview = "親愛的會員，感謝您對本平台的支持！...",
            Content = "親愛的會員，感謝您對本平台的支持！即日起至 [日期]，[活動內容]！"
        },
        new {
            Category = "announcement",
            CategoryText = "系統公告",
            Title = "模板：重要系統公告",
            Preview = "親愛的用戶，我們有重要事項需要通知您...",
            Content = "親愛的用戶，我們有重要事項需要通知您：[公告內容]。如有任何疑問，請聯繫客服中心。"
        },
        new {
            Category = "warning",
            CategoryText = "警告通知",
            Title = "模板：帳號異常警告",
            Preview = "親愛的會員 [用戶姓名]，經系統偵測...",
            Content = "親愛的會員 [用戶姓名]，經系統偵測，您的帳號 [操作] 操作異常，為保護您的帳號安全，我們已暫時限制您的部分功能。如有疑問請聯繫客服。"
        }
    };
    
    ViewData["MessageTemplates"] = messageTemplates;
}

<!-- 確認發送 Modal -->
<div class="modal fade" id="confirmSendModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="confirmSendModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmSendModalLabel">確認發送訊息</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>您確定要發送此訊息給 <strong id="confirmAudienceText"></strong> 嗎？</p>
                <div id="confirmUserDetails" style="display: none;">
                    <p>接收者：<strong id="confirmUserName"></strong> (<span id="confirmUserId"></span>)</p>
                </div>
                <p class="text-danger fw-bold">此操作無法復原、刪除或撤回。</p>
                
                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" id="confirmCheckbox">
                    <label class="form-check-label" for="confirmCheckbox">
                        我確認要執行此操作
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-danger" id="finalSendBtn" disabled onclick="sendMessage()">確認發送</button>
            </div>
        </div>
    </div>
</div>

<!-- 插入模板 Modal -->
<div class="modal fade" id="templateModal" tabindex="-1" aria-labelledby="templateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="templateModalLabel">選擇訊息模板</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="templateCategoryFilter" class="form-label">篩選模板類別</label>
                    <select id="templateCategoryFilter" class="form-select">
                        <option value="all" selected>所有類別</option>
                        <option value="maintenance">維護通知</option>
                        <option value="promotion">優惠活動</option>
                        <option value="announcement">系統公告</option>
                        <option value="warning">警告通知</option>
                    </select>
                </div>
                <div id="templateList" class="list-group">
                    @foreach (var template in messageTemplates)
                    {
                        <a href="#" class="list-group-item list-group-item-action template-item" 
                           data-template-category="@template.Category" 
                           data-template-content="@template.Content"
                           onclick="selectTemplate(this)">
                            <h6 class="mb-1">@template.Title</h6>
                            <p class="mb-1 small text-muted">@template.Preview</p>
                            <small class="text-info">類別：@template.CategoryText</small>
                        </a>
                    }
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
            </div>
        </div>
    </div>
</div>