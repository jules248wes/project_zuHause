@model dynamic

@{
    var tabId = ViewData["TabId"] as string ?? "all";
    var hasLandlordFilter = ViewData["HasLandlordFilter"] as bool? ?? true;
    var hasIdUpload = ViewData["HasIdUpload"] as bool? ?? false;
    var hasApplyDate = ViewData["HasApplyDate"] as bool? ?? false;
    var hasAccountStatus = ViewData["HasAccountStatus"] as bool? ?? true;
    var hasVerificationStatus = ViewData["HasVerificationStatus"] as bool? ?? true;
    var verificationStatusOptions = ViewData["VerificationStatusOptions"] as string ?? "full";
}

<div class="card mt-3">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">會員篩選</h5>
        <button type="button" class="btn btn-outline-info btn-sm" id="advancedSearchBtn@(tabId)">
            <i class="fas fa-chevron-down"></i> 進階篩選
        </button>
    </div>
    <div class="card-body">
        <form>
            <!-- 基本搜尋列 -->
            <div class="row g-3 mb-3">
                @{
                    var hasAnyStatusFilter = hasIdUpload || hasAccountStatus || hasVerificationStatus;
                    var searchFieldWidth = hasAnyStatusFilter ? "col-md-6" : "col-md-8";
                }
                <div class="@searchFieldWidth">
                    <label for="searchInput@(tabId)" class="form-label">關鍵字搜尋</label>
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="搜尋關鍵字..." id="searchInput@(tabId)">
                        <select class="form-select" id="searchField@(tabId)" style="max-width: 150px;">
                            <option value="memberID">會員ID</option>
                            <option value="memberName">會員姓名</option>
                            <option value="email">電子郵件</option>
                            <option value="phoneNumber">手機號碼</option>
                            <option value="nationalNo">身分證號</option>
                            <option value="addressLine">詳細地址</option>
                        </select>
                    </div>
                </div>
                
                @if (hasIdUpload)
                {
                    <div class="col-md-2">
                        <label for="idUploadStatus@(tabId)" class="form-label">身分證上傳</label>
                        <select class="form-select" id="idUploadStatus@(tabId)">
                            <option value="">全部</option>
                            <option value="uploaded">已上傳</option>
                            <option value="not_uploaded">未上傳</option>
                            <option value="reviewing">審核中</option>
                            <option value="approved">審核通過</option>
                            <option value="rejected">審核拒絕</option>
                        </select>
                    </div>
                }
                else if (hasVerificationStatus)
                {
                    <div class="col-md-2">
                        <label for="verificationStatus@(tabId)" class="form-label">身分證驗證</label>
                        <select class="form-select" id="verificationStatus@(tabId)">
                            <option value="">全部</option>
                            <option value="verified">已驗證</option>
                            <option value="pending">等待驗證</option>
                            @if (verificationStatusOptions != "limited")
                            {
                                <option value="unverified">尚未驗證</option>
                            }
                        </select>
                    </div>
                }
                
                @if (hasAccountStatus)
                {
                    <div class="col-md-2">
                        <label for="accountStatus@(tabId)" class="form-label">帳戶狀態</label>
                        <select class="form-select" id="accountStatus@(tabId)">
                            <option value="">全部</option>
                            <option value="active">啟用中</option>
                            <option value="suspended">暫時停權</option>
                            <option value="banned">永久停用</option>
                        </select>
                    </div>
                }
                
                @{
                    var buttonFieldWidth = hasAnyStatusFilter ? "col-md-4" : "col-md-4";
                }
                <div class="@buttonFieldWidth">
                    <label class="form-label d-block">&nbsp;</label>
                    <button type="button" class="btn btn-primary me-2" id="searchBtn@(tabId)">
                        <i class="fas fa-search"></i> 搜尋
                    </button>
                    <button type="button" class="btn btn-outline-secondary" id="resetBtn@(tabId)">
                        <i class="fas fa-redo"></i> 重置
                    </button>
                </div>
            </div>
            
            <!-- 進階搜尋摺疊區域 -->
            <div class="collapse" id="advancedSearchCollapse@(tabId)">
                <div class="border-top pt-3">
                    <div class="row g-3">
                        <div class="col-md-2">
                            <label for="gender@(tabId)" class="form-label">性別</label>
                            <select class="form-select" id="gender@(tabId)">
                                <option value="">全部</option>
                                <option value="male">男性</option>
                                <option value="female">女性</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        
                        @if (hasLandlordFilter)
                        {
                            <div class="col-md-2">
                                <label for="isLandlord@(tabId)" class="form-label">房東身分</label>
                                <select class="form-select" id="isLandlord@(tabId)">
                                    <option value="">全部</option>
                                    <option value="true">是</option>
                                    <option value="false">否</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="primaryRentalCityID@(tabId)" class="form-label">主要租賃城市</label>
                                <select class="form-select" id="primaryRentalCityID@(tabId)">
                                    <option value="">全部</option>
                                    <option value="1">台北市</option>
                                    <option value="2">新北市</option>
                                    <option value="3">桃園市</option>
                                    <option value="4">台中市</option>
                                    <option value="5">台南市</option>
                                    <option value="6">高雄市</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="residenceCityID@(tabId)" class="form-label">居住城市</label>
                                <select class="form-select" id="residenceCityID@(tabId)">
                                    <option value="">全部</option>
                                    <option value="1">台北市</option>
                                    <option value="2">新北市</option>
                                    <option value="3">桃園市</option>
                                    <option value="4">台中市</option>
                                    <option value="5">台南市</option>
                                    <option value="6">高雄市</option>
                                </select>
                            </div>
                        }
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-4">
                            <label class="form-label">註冊日期範圍</label>
                            <div class="input-group">
                                <input type="date" class="form-control" id="registerDateStart@(tabId)" placeholder="開始日期">
                                <span class="input-group-text">至</span>
                                <input type="date" class="form-control" id="registerDateEnd@(tabId)" placeholder="結束日期">
                            </div>
                        </div>
                        
                        @if (hasApplyDate)
                        {
                            <div class="col-md-4">
                                <label class="form-label">申請日期範圍</label>
                                <div class="input-group">
                                    <input type="date" class="form-control" id="applyDateStart@(tabId)" placeholder="開始日期">
                                    <span class="input-group-text">至</span>
                                    <input type="date" class="form-control" id="applyDateEnd@(tabId)" placeholder="結束日期">
                                </div>
                            </div>
                        }
                        
                        <div class="col-md-4">
                            <label class="form-label">最後登入日期範圍</label>
                            <div class="input-group">
                                <input type="date" class="form-control" id="lastLoginDateStart@(tabId)" placeholder="開始日期">
                                <span class="input-group-text">至</span>
                                <input type="date" class="form-control" id="lastLoginDateEnd@(tabId)" placeholder="結束日期">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>