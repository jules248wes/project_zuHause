<!-- 確認回覆 Modal -->
<div class="modal fade" id="confirmReplyModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">確認送出回覆</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>即將送出您的回覆，並將此案件狀態更新為「已回覆」。</p>
                <p><strong>此操作無法復原，確定要繼續嗎？</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="confirmReplyBtn">確認送出</button>
            </div>
        </div>
    </div>
</div>

<!-- 確認變更狀態 Modal -->
<div class="modal fade" id="confirmStatusChangeModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">確認變更狀態</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>您確定要將案件狀態變更為 <strong id="newStatusText"></strong> 嗎？</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-danger" id="confirmStatusChangeBtn">確認變更</button>
            </div>
        </div>
    </div>
</div>

<!-- 插入模板 Modal -->
<div class="modal fade" id="templateModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">選擇回覆模板</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- 模板類別篩選器 -->
                <div class="mb-3">
                    <label for="templateCategory" class="form-label">模板類別</label>
                    <select class="form-select" id="templateCategory" onchange="filterTemplates()">
                        <option value="">全部模板</option>
                        <option value="rental">租屋相關</option>
                        <option value="account">帳號問題</option>
                        <option value="furniture">傢俱訂單</option>
                        <option value="general">一般客服</option>
                    </select>
                </div>
                
                <!-- 模板列表 -->
                <div class="list-group" id="templateList">
                    <a href="#" class="list-group-item list-group-item-action template-item" data-category="rental" onclick="selectTemplate('template1')">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">模板一：租金問題通用回覆</h6>
                            <small class="text-muted">租屋相關</small>
                        </div>
                        <p class="mb-1 small">親愛的用戶，感謝您的詢問。關於租金問題...</p>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action template-item" data-category="rental" onclick="selectTemplate('template2')">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">模板二：預約看房回覆</h6>
                            <small class="text-muted">租屋相關</small>
                        </div>
                        <p class="mb-1 small">我們已收到您的預約看房申請，將會有專人與您聯繫...</p>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action template-item" data-category="account" onclick="selectTemplate('template3')">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">模板三：帳號問題通用回覆</h6>
                            <small class="text-muted">帳號問題</small>
                        </div>
                        <p class="mb-1 small">關於您的帳號問題，請您提供更詳細的資訊...</p>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action template-item" data-category="rental" onclick="selectTemplate('template4')">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">模板四：租約問題處理</h6>
                            <small class="text-muted">租屋相關</small>
                        </div>
                        <p class="mb-1 small">關於您的租約問題，我們將協助您處理...</p>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action template-item" data-category="furniture" onclick="selectTemplate('template5')">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">模板五：傢俱訂單查詢</h6>
                            <small class="text-muted">傢俱訂單</small>
                        </div>
                        <p class="mb-1 small">關於您的傢俱訂單，我們為您查詢處理狀況...</p>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action template-item" data-category="general" onclick="selectTemplate('template6')">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">模板六：一般問題感謝回覆</h6>
                            <small class="text-muted">一般客服</small>
                        </div>
                        <p class="mb-1 small">感謝您的來信，我們已收到您的意見...</p>
                    </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
            </div>
        </div>
    </div>
</div>

<script>
    // 全域函數 - 選擇回覆模板
    function selectTemplate(templateId) {
        const templates = {
            template1: '親愛的用戶，感謝您的詢問。關於您提到的租金問題，我們網站上所標示的價格均為最新且最準確的資訊。租金已包含管理費，但不包含網路費用，網路需由承租方自行申請。希望這個回覆能幫助到您！',
            template2: '親愛的用戶，我們已收到您的預約看房申請，專員將會在 24 小時內透過電話與您聯繫，確認詳細時間與細節，請您留意來電。',
            template3: '親愛的用戶，關於您的帳號問題，為了更好地協助您，請您提供註冊時使用的 Email 或手機號碼，以便我們為您查詢。',
            template4: '親愛的用戶，感謝您的來信。關於您提到的租約問題，我們將協助您處理相關事宜。為了提供更精準的服務，請您提供租約編號，我們會儘快為您查詢並回覆。',
            template5: '親愛的用戶，關於您的傢俱訂單查詢，我們為您確認訂單狀態。請您提供訂單編號，以便我們為您查詢詳細的配送時間和處理進度。',
            template6: '親愛的用戶，感謝您的來信，我們已收到您的意見與建議。您的回饋對我們非常重要，我們會持續改善服務品質。如有其他問題歡迎隨時與我們聯繫。'
        };
        
        document.getElementById('replyContent').value = templates[templateId];
        
        // 關閉模板選擇 Modal
        var templateModal = bootstrap.Modal.getInstance(document.getElementById('templateModal'));
        templateModal.hide();
    }

    // 全域函數 - 篩選模板
    function filterTemplates() {
        const category = document.getElementById('templateCategory').value;
        const templateItems = document.querySelectorAll('.template-item');
        
        templateItems.forEach(function(item) {
            const itemCategory = item.getAttribute('data-category');
            
            if (category === '' || itemCategory === category) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        // 狀態變更事件
        document.getElementById('statusChange').addEventListener('change', function() {
            if (this.value) {
                // 更新確認 Modal 文字
                var statusText = this.options[this.selectedIndex].text;
                document.getElementById('newStatusText').textContent = statusText;
                
                // 顯示確認 Modal
                var confirmModal = new bootstrap.Modal(document.getElementById('confirmStatusChangeModal'), {
                    backdrop: 'static',
                    keyboard: false
                });
                confirmModal.show();
            }
        });

        // 確認變更狀態按鈕事件
        document.getElementById('confirmStatusChangeBtn').addEventListener('click', function() {
            var newStatus = document.getElementById('statusChange').value;
            console.log('變更案件狀態為:', newStatus);
            
            // 這裡應該發送請求到後端更新狀態
            // 目前只是示範，實際需要實作後端API
            
            // 關閉 Modal
            var confirmModal = bootstrap.Modal.getInstance(document.getElementById('confirmStatusChangeModal'));
            confirmModal.hide();
            
            // 顯示成功訊息
            alert('狀態已成功變更');
        });

        // 確認送出回覆按鈕事件
        document.getElementById('confirmReplyBtn').addEventListener('click', function() {
            var replyContent = document.getElementById('replyContent').value;
            
            if (!replyContent.trim()) {
                alert('請輸入回覆內容');
                return;
            }
            
            console.log('送出回覆:', replyContent);
            
            // 這裡應該發送請求到後端儲存回覆
            // 目前只是示範，實際需要實作後端API
            
            // 關閉 Modal
            var confirmModal = bootstrap.Modal.getInstance(document.getElementById('confirmReplyModal'));
            confirmModal.hide();
            
            // 顯示成功訊息並清空輸入框
            alert('回覆已成功送出');
            document.getElementById('replyContent').value = '';
        });

        // 取消狀態變更時重置選擇
        document.getElementById('confirmStatusChangeModal').addEventListener('hidden.bs.modal', function () {
            document.getElementById('statusChange').value = '';
        });
    });
</script>