# 後台 (Admin Panel) 邏輯架構規劃

本文件基於 "負責開發功能.md" 的需求，規劃後台管理的邏輯架構。

## 總體架構

採用 MVC (Model-View-Controller) 設計模式。後台功能將主要圍繞 `AdminController` 或依功能拆分的多個 Controller 進行。每個功能模組將包含對應的 Service 層來處理業務邏輯，以及 Repository 層來進行資料庫操作。

### Controller (控制器)
負責接收 HTTP 請求，調用對應的 Service 處理業務邏輯，並回傳 View。

### Service (服務層)
封裝核心業務邏輯，例如用戶驗證、訂單狀態變更等。一個 Service 可以組合多個 Repository 來完成一個複雜的操作。

### Repository (倉儲層)
負責與資料庫進行直接互動 (CRUD)，將資料庫操作與業務邏輯分離。

---

## 通用開發原則

本節內容來自 `Notes on Development Requirements.md`，旨在統一開發標準。

### 1. 格式化與命名

-   **日期格式:** 前端顯示統一為 `2025-07-08 01:22:30`。
-   **命名法:** C# 統一使用小駝峰命名法 (Camel Case)。
-   **架構慣例:**
    -   遵循 Model-View-Controller (MVC) 的標準命名。
    -   為區分後台 (Backstage) 功能，相關的 Controller 和 View 應加上 `admin_` 前綴。
    -   避免使用過於通用的詞彙，如 `user`，以減少命名衝突。

### 2. 開發與設計原則

-   **視覺設計:**
    -   追求現代化 (Modern)、簡約 (Simple)、平面化 (Flat)、極簡 (Minimalism) 風格。
-   **使用者體驗 (UX):**
    -   **直覺式設計:** 提供清晰的視覺回饋和導航。
    -   **內容導向:** 優先顯示重要資訊，減少用戶認知負擔。
    -   **操作明確:** 主要功能按鈕 (CTA) 需醒目，表單標籤和錯誤訊息需清晰。
-   **開發方針:**
    -   **最小可行方案 (MVP):** 優先開發核心功能，快速迭代。
    -   **程式碼風格:** 保持簡潔易讀 (Clean Code)、易於維護 (Maintainable)，並遵循 SOLID 原則。
    -   **註解:** 對複雜方法、業務邏輯和重要演算法，應加上必要的 XML 或行內註解。

### 3. 登入與驗證機制

-   **管理員登入:** 所有後台功能都必須在管理員登入後才能存取。開發時需考慮未來與登入模組的整合，包含用戶會話 (Session) 和權限管理。
-   **互動驗證:**
    -   所有重要的確認或驗證操作，應使用 Bootstrap Modal 彈窗。
    -   Modal 應設定 `backdrop: 'static'` 和 `keyboard: false`，防止用戶意外關閉。
    -   提供二次確認 (Double Check) 機制，避免誤操作。

---

## 功能模組劃分

### 1. 用戶管理 (User Management)

-   **Controller:** `AdminUsersController`
-   **主要功能:**
    -   **列表與搜尋 (`Index`)**:
        -   顯示所有用戶列表，支持分頁。
        -   提供關鍵字搜尋功能 (如：姓名、Email、電話)。
        -   提供篩選功能 (如：已驗證/未驗證、註冊日期範圍)。
    -   **用戶詳情 (`Details(userId)`)**:
        -   顯示單一用戶的詳細資料。
        -   **關聯資料:**
            -   用戶基本資料 (來自 `Users` table)。
            -   歷史租約 (來自 `Leases` table)。
            -   歷史傢俱訂單 (來自 `FurnitureOrders` table)。
            -   客服記錄 (來自 `SupportTickets` table)。
    -   **用戶驗證 (`Verify(userId)`)**:
        -   提供一個操作按鈕或介面來變更用戶的 `IsVerified` 狀態。
        -   記錄操作的管理員及時間。

### 2. 屋源管理 (Property Management)

-   **Controller:** `AdminPropertiesController`
-   **主要功能:**
    -   **列表與搜尋 (`Index`)**:
        -   顯示所有屋源列表，支持分頁。
        -   提供關鍵字搜尋功能 (如：地址、標題)。
        -   提供篩選功能 (如：已驗證/未驗證、發布日期、房東)。
    -   **屋源詳情 (`Details(propertyId)`)**:
        -   顯示單一屋源的詳細資料。
        -   **關聯資料:**
            -   屋源基本資料 (來自 `Properties` table)。
            -   關聯的房東資料 (來自 `Users` table)。
            -   歷史租約 (來自 `Leases` table)。
            -   收到的檢舉記錄 (來自 `Reports` table)。
    -   **屋源驗證 (`Verify(propertyId)`)**:
        -   提供操作介面來變更屋源的 `IsVerified` 狀態。
        -   記錄操作的管理員及時間。

### 3. 傢俱訂單管理 (Furniture Order Management)

-   **Controller:** `AdminOrdersController`
-   **主要功能:**
    -   **訂單列表 (`Index`)**:
        -   顯示所有傢俱訂單，支持分頁與搜尋。
        -   提供狀態篩選 (新訂單、準備中、已出貨、已完成)。
    -   **狀態管理 (`UpdateStatus(orderId, newStatus)`)**:
        -   在列表頁或詳情頁提供介面，讓管理員可以更新訂單狀態。
        -   狀態變更時，可觸發通知給用戶。

### 4. 溝通與支援管理 (Communication & Support Management)

-   **Controller:** `AdminSupportController`
-   **主要功能:**
    -   **投訴列表 (`Complaints`)**:
        -   列出所有用戶投訴。
        -   管理狀態 (未處理、處理中、已回覆)。
        -   可直接在介面上進行回覆。
    -   **客服訊息列表 (`Tickets`)**:
        -   列出所有客服訊息。
        -   管理狀態及回覆。
    -   **系統訊息發送 (`SystemMessages`)**:
        -   列表顯示所有已發送的系統訊息。
        -   提供發送新訊息的介面 (`Create`)。
            -   可選擇單一用戶或全體用戶。
            -   可包含標題和內文。

### 5. 內容管理 (Content Management)

-   **Controller:** `AdminContentController`
-   **主要功能:**
    -   **平台公告 (`Announcements`)**:
        -   公告列表 (`Index`)，包含新增、編輯、刪除按鈕。
        -   公告編輯頁 (`Edit(announcementId)`)，包含標題、內文、附件上傳、顯示/下架開關。
    -   **文字模板管理 (`TextTemplates`)**:
        -   模板列表 (`Index`)。
        -   模板編輯頁 (`Edit(templateId)`)。
            -   欄位：標題、所屬類別、內文、是否啟用。
            -   所屬類別 (`TemplateCategories`) 應提供動態新增/管理功能。
        -   在客服、訊息、公告編輯器中，提供插入模板的按鈕。
