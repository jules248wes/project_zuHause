# 房源管理頁面

本文檔用於規劃「房源管理」功能頁面的需求與設計。 

## 前提

- members.isLandlord == true && members.memberTypeID == 2
- members.identityVerifiedAt 不等於 null
- 不符合以上條件，無法查看到房源管理、刊登房源頁面。

- 僅列出與登入的使用者的 memberID 下的房源資料。

## 房源狀態

|階段|觸發動作/執行者|事件|前端房源對應標籤顯示|寫入的資料表|寫入的值|
|---|---|---|---|---|---|
|建立房源|房東提交刊登房源表單|房源建立事件|審核中|properties.statusCode|PENDING|
|後台審核|管理員審核操作|房源審核通過事件|待付款|properties.statusCode|PENDING_PAYMENT|
|後台審核|管理員審核動作|房源審核須補件事件|審核未通過(待補件)|properties.statusCode|REJECT_REVISE|
|後台審核|管理員審核動作|房源審核不通過事件|審核未通過|properties.statusCode|REJECTED|
|進行支付|房東成功支付|刊登費繳清並上架事件|上架中|properties.statusCode|LISTED|
|申請租屋|房東同意出租並發出合約|送出合約簽署事件|已發出合約|properties.statusCode|CONTRACT_ISSUED|
|合約到期|房源租約即將到期|續約事件(租約到期前一個月)|待續約|properties.statusCode|PENDING_RENEWAL|
|合約到期|租客同意續約|重新送出合約事件|續約(房客申請中)|properties.statusCode|LEASE_EXPIRED_RENEWING|
|合約到期|租客拒絕續約|重新刊登事件|閒置中|properties.statusCode|IDLE|
|房源出租|合約完成簽約|房源成功出租事件|出租中|properties.statusCode|ALREADY_RENTED|
|房源下架|房源未付款或下架|無效房源事件|房源已下架|properties.statusCode|INVALID|
|強制下架|房源違規遭管理員強制下架|違規房源事件|房源違規遭強制下架，請重新申請上架|properties.statusCode|BANNED|

- 若觸發重新刊登事件的閒置中房源，可操作重新上架，但須重新進入刊登房源畫面(保留刊登歷史內容)，重新選擇刊登費方案，送出房源，再走一次刊登流程。

---

## 預約看房類型初始，皆觸發寫入資料表及對應值：rentalApplications.applicationType == HOUSE_VIEWING
|階段|觸發動作/執行者|事件|前端通知的對應顯示|寫入的資料表|寫入的值|
|---|---|---|---|---|---|
|預約看房|租客提出預約看房|預約看房事件|申請中|rentalApplications.currentStatus|APPLIED|
|預約看房|房東查看預約通知|審核預約事件|待審核|rentalApplications.currentStatus|PENDING|
|預約看房|房東同意看房申請|同意預約事件|已同意申請|rentalApplications.currentStatus|APPROVED|
|預約看房|房東拒絕看房申請|拒絕預約事件|已拒絕申請|rentalApplications.currentStatus|REJECTED|
|預約看房|房東更改看房日期|房東改期事件|申請改期|rentalApplications.currentStatus|REQUEST_RESCHEDULE|
|預約看房|租客更改看房日期|房客改期事件|申請改期|rentalApplications.currentStatus|REQUEST_RESCHEDULE|
|預約看房|房東同意改期申請|更改預約日期事件|已改期|rentalApplications.currentStatus|RESCHEDULED|
|預約看房|租客同意改期申請|更改預約日期事件|已改期|rentalApplications.currentStatus|RESCHEDULED|
|預約看房|房源已發出租約|等待回應事件|等待房東回應|rentalApplications.currentStatus|WAITING_RESPONSE|
|預約看房|房源已出租或下架|系統統一拒絕預約事件|房源已下架|rentalApplications.currentStatus|INVALID|
|預約看房|預約日期已過|過期事件|已過期|rentalApplications.currentStatus|EXPIRED|

---

## 申請租屋類型初始，皆觸發寫入資料表及對應值：rentalApplications.applicationType == RENTAL
|階段|觸發動作/執行者|事件|前端通知的對應顯示|寫入的資料表|寫入的值|
|---|---|---|---|---|---|
|申請租屋|租客提出申請租屋|申請租屋事件|申請中|rentalApplications.currentStatus|APPLIED|
|申請租屋|房東查看申請通知|審核申請事件|待審核|rentalApplications.currentStatus|PENDING|
|申請租屋|房東同意租屋申請|同意出租事件|租約編輯中|rentalApplications.currentStatus|WAITING_CONTRACT|
|申請租屋|房東已發出租約|等待租約簽署完成事件|簽署中|rentalApplications.currentStatus|SIGNING|
|申請租屋|房東拒絕租屋申請|拒絕租屋申請事件|已拒絕申請|rentalApplications.currentStatus|REJECTED|
|申請租屋|完成租約|租約簽署完成|租約已成立|rentalApplications.currentStatus|CONTRACTED|

---

- 房源管理頁面只需要知道、有收到以下資料表的欄位變動，就可同步修改相同事件連動的欄位。

## 以下後台審核初始，皆觸發寫入資料表及對應值：approvals.moduleCode == PROPERTY
|階段|觸發動作/執行者|事件|approvals.statusCode 的值|關聯寫入的資料表|寫入的值|
|---|---|---|---|---|---|
|建立房源|房東提交刊登房源表單|房源建立事件|PENDING|approvalItems.actionType|SUBMIT|
|後台審核|管理員審核操作|房源審核通過事件|APPROVED|approvalItems.actionType|APPROVED|
|後台審核|管理員審核動作|房源審核須補件事件|REJECT_REVISE|approvalItems.actionType|REJECT_REVISE|
|後台審核|管理員審核動作|房源審核不通過事件|REJECT_FINAL|approvalItems.actionType|REJECT_FINAL|